---
import {
  ScheduleLayoutGrid,
  type ScheduleLayoutGridProps,
} from '@/features/shared/components/ScheduleLayoutGrid'
import { arc2025Day1ScheduleLayout } from '../data'
import type { GridLayout } from '@/features/schedule'
import type { Arc2025StagePayload, Arc2025EventPayload } from '../types'

const mapScheduleLayoutDataToUI = ({
  trackSlots,
  eventsByTrack,
  timeSlots,
}: GridLayout<
  Arc2025StagePayload,
  Arc2025EventPayload
>): ScheduleLayoutGridProps => {
  const rows = trackSlots.map((track) => {
    const events = eventsByTrack.get(track.id)

    if (!events) {
      return {
        track: {
          id: track.id,
          name: track.payload?.name ?? '',
          color: track.payload?.color ?? '',
          order: track.order,
          category: track.payload?.category ?? '',
        },
        slots: [],
      }
    }

    const mappedSlots = events.map(({ position, event }) => {
      return {
        position,
        slot: {
          id: event.id,
          trackId: event.trackId,
          header: {
            title: event.payload?.title ?? '',
            subTitle: event.payload?.subTitle ?? '',
          },
          body: {
            duration: event.payload?.duration,
            time: {
              start: event.time.start,
              end: event.time.end,
            },
          },
          footer: {
            infoButton:
              event.payload?.description || event.payload?.galleryUrl
                ? 'MÃ¡s Info'
                : undefined,
          },
          labels: {
            left: event.payload?.category ?? '',
            right: track.payload?.name ?? '',
          },
        },
      } satisfies ScheduleLayoutGridProps['rows'][number]['slots'][number]
    })

    return {
      track: {
        id: track.id,
        name: track.payload?.name ?? '',
        color: track.payload?.color ?? '',
        order: track.order,
        category: track.payload?.category ?? '',
      },
      slots: mappedSlots,
    }
  })

  return {
    timeSlots: [...timeSlots],
    rows,
  }
}
---

<ScheduleLayoutGrid
  client:load
  {...mapScheduleLayoutDataToUI(arc2025Day1ScheduleLayout)}
/>
