---
import { ScheduleGrid, adaptScheduleDataToGrid } from '@/features/schedule'
import FONDO_WEB_PROGRAMACION from '@/features/arc2025/assets/FONDO_VERDE.webp'
import {
  arc2025Day1ScheduleData,
  arc2025Day2ScheduleData,
} from '@/features/arc2025/data'
import type { ScheduleTrack } from '@/features/schedule'
import type { LayoutEvent } from '@/features/schedule'
import type {
  Arc2025StagePayload,
  Arc2025EventPayload,
} from '@/features/arc2025/types'
import type {
  UIHeaderItem,
  UIColumnItem,
  ScheduleDay,
} from '@/features/schedule'
import Title from '../ui/Title.astro'

const mapTrack = (track: ScheduleTrack<Arc2025StagePayload>): UIHeaderItem => ({
  id: track.id,
  name: track.payload?.name ?? '',
  color: track.payload?.color ?? '',
  order: track.order,
  category: track.payload?.category ?? '',
})

const mapEvent = (event: LayoutEvent<Arc2025EventPayload>): UIColumnItem => ({
  id: event.event.id,
  header: {
    title: event.event.payload?.title ?? '',
    subTitle: event.event.payload?.subTitle ?? '',
  },
  body: {
    description: event.event.payload?.description ?? '',
    galleryUrl: event.event.payload?.galleryUrl,
    duration: event.event.payload?.duration,
    time: {
      start: event.event.time.start,
      end: event.event.time.end,
    },
  },
  footer: {
    infoButton:
      event.event.payload?.description || event.event.payload?.galleryUrl
        ? 'Más Info'
        : undefined,
  },
  labels: {
    left: event.event.payload?.category ?? '',
  },
})

const scheduleDays: ScheduleDay[] = [
  {
    label: 'Sábado 18',
    data: adaptScheduleDataToGrid(arc2025Day1ScheduleData, mapTrack, mapEvent),
  },
  {
    label: 'Domingo 19',
    data: adaptScheduleDataToGrid(arc2025Day2ScheduleData, mapTrack, mapEvent),
  },
]
---

<section id='programacion' class='relative min-h-screen'>
  <img
    aria-hidden='true'
    alt='Fondo de la sección Programación del Festival ARC 2025 - Festival de las Artes Región de Coquimbo'
    src={FONDO_WEB_PROGRAMACION.src}
    height={FONDO_WEB_PROGRAMACION.height}
    width={FONDO_WEB_PROGRAMACION.width}
    loading='lazy'
    class='fixed top-0 right-0 left-0 -z-30 h-lvh w-full object-cover object-center landscape:h-full'
  />
  <Title subTitle='Sábado 18 y Domingo 19'>Programación</Title>
  <ScheduleGrid client:idle days={scheduleDays} />
</section>
